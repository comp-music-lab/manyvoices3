N = 14;
d = zeros(14, 1);
sgm = zeros(14, 1);

dursongfile = {'./d20240724_s1_dur_sing.csv', ...
    './d20240724_s2_dur_sing.csv', ...
    './d20240724_s3_dur_sing.csv', ...
    './d20240724_s4_dur_sing.csv', ...
    './d20240724_s5_dur_sing.csv', ...
    './d20240725_s6_dur_sing.csv', ...
    './d20240725_s7_dur_sing.csv', ...
    './d20240725_s8_dur_sing.csv', ...
    './d20240725_s9_dur_sing.csv', ...
    './d20240725_s10_dur_sing.csv', ...
    './d20240821_s11_dur_sing.csv', ...
    './d20240821_s12_dur_sing.csv', ...
    './d20240821_s13_dur_sing.csv', ...
    './d20240821_s14_dur_sing.csv'};

durconvfile = {'./d20240724_s1_dur_conv.csv', ...
    './d20240724_s2_dur_conv.csv', ...
    './d20240724_s3_dur_conv.csv', ...
    './d20240724_s4_dur_conv.csv', ...
    './d20240724_s5_dur_conv.csv', ...
    './d20240725_s6_dur_conv.csv', ...
    './d20240725_s7_dur_conv.csv', ...
    './d20240725_s8_dur_conv.csv', ...
    './d20240725_s9_dur_conv.csv', ...
    './d20240725_s10_dur_conv.csv', ...
    './d20240821_s11_dur_conv.csv', ...
    './d20240821_s12_dur_conv.csv', ...
    './d20240821_s13_dur_conv.csv', ...
    './d20240821_s14_dur_conv.csv'};

for i=1:N
    dur_songfile = readtable(dursongfile{i}, 'VariableNamingRule', 'preserve');
        dur_song = dur_songfile.IOI;
    dur_convfile = readtable(durconvfile{i}, 'VariableNamingRule', 'preserve');
        dur_conv = dur_convfile.IOI;
    [d_i, sgm_i] = pb_effectsize(dur_conv, dur_song);
    d(i) = d_i;
    sgm(i) = sgm_i;

    figure(i); histogram(dur_song); hold on; histogram(dur_conv); hold off
end

[CI, pval, mu_hat] = exactCI(d, sgm, 0.05/6, 0.5);


cohensd = sqrt(2)*norminv(d);
disp("Cohen's d value:")
disp(cohensd)

disp("Confidence Interval (CI):")
disp(CI)

disp("p value:")
disp(pval)

disp("Estimated mean effect size: mu_hat:")
disp(mu_hat)

% Save cohen D
results = table(d, sgm, cohensd, 'VariableNames', {'d', 'sgm', 'Cohens_d'});
writetable(results, ['./IOI_cohend_results.csv']);

% Save CI, p value and estimated mean effect size
extra_results = table(CI(1), CI(2), pval, mu_hat, ...
    'VariableNames', {'CI_lower', 'CI_upper', 'p_value', 'mu_hat'});
writetable(extra_results, ['./IOI_extra_results.csv']);
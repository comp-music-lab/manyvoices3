N = 14;
d = zeros(14, 1);
sgm = zeros(14, 1);

f0songfile = {'./f20240724_s1_f0_sing_processed.csv', ...
    './f20240724_s2_f0_sing_processed.csv', ...
    './f20240724_s3_f0_sing_processed.csv', ...
    './f20240724_s4_f0_sing_processed.csv', ...
    './f20240724_s5_f0_sing_processed.csv', ...
    './f20240725_s1_f0_sing_processed.csv', ...
    './f20240725_s2_f0_sing_processed.csv', ...
    './f20240725_s3_f0_sing_processed.csv', ...
    './f20240725_s4_f0_sing_processed.csv', ...
    './f20240725_s5_f0_sing_processed.csv', ...
    './f20240821_s1_f0_sing_processed.csv', ...
    './f20240821_s2_f0_sing_processed.csv', ...
    './f20240821_s3_f0_sing_processed.csv', ...
    './f20240821_s4_f0_sing_processed.csv'};

f0convfile = {'./f20240724_s1_f0_conv_processed.csv', ...
    './f20240724_s2_f0_conv_processed.csv', ...
    './f20240724_s3_f0_conv_processed.csv', ...
    './f20240724_s4_f0_conv_processed.csv', ...
    './f20240724_s5_f0_conv_processed.csv', ...
    './f20240725_s1_f0_conv_processed.csv', ...
    './f20240725_s2_f0_conv_processed.csv', ...
    './f20240725_s3_f0_conv_processed.csv', ...
    './f20240725_s4_f0_conv_processed.csv', ...
    './f20240725_s5_f0_conv_processed.csv', ...
    './f20240821_s1_f0_conv_processed.csv', ...
    './f20240821_s2_f0_conv_processed.csv', ...
    './f20240821_s3_f0_conv_processed.csv', ...
    './f20240821_s4_f0_conv_processed.csv'};

for i=1:N
    f0_songfile = readtable(f0songfile{i});
    f0_song = f0_songfile.f0(f0_songfile.f0 > 0);
    f0_convfile = readtable(f0convfile{i});
    f0_conv = f0_convfile.f0(f0_convfile.f0 > 0);
    [d_i, sgm_i] = pb_effectsize(f0_song, f0_conv);
    d(i) = d_i;
    sgm(i) = sgm_i;

    figure(i); histogram(f0_song); hold on; histogram(f0_conv); hold off
end

[CI, pval, mu_hat] = exactCI(d, sgm, 0.05*3, 0.5);
cohensd = sqrt(2)*norminv(d);

disp("Cohen's d value:")
disp(cohensd)

disp("Confidence Interval (CI):")
disp(CI)

disp("p value:")
disp(pval)

disp("Estimated mean effect size: mu_hat:")
disp(mu_hat)

% Save cohen D
results = table(d, sgm, cohensd, 'VariableNames', {'d', 'sgm', 'Cohens_d'});
writetable(results, './f0_cohend_results.csv');

% Save CI, p value and estimated mean effect size
extra_results = table(CI(1), CI(2), pval, mu_hat, ...
    'VariableNames', {'CI_lower', 'CI_upper', 'p_value', 'mu_hat'});
writetable(extra_results, './f0_extra_results.csv');
